<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>暗記カード</title>

	<!-- Ocean 共通テーマCSS -->
	<link rel="stylesheet" th:href="@{/css/ocean-theme.css}" />
	<link rel="stylesheet" th:href="@{/css/style.css}" />
	<link rel="icon" type="image/x-icon" th:href="@{/favicon.ico}">
</head>

<style>
	.quiz-container{
		margin: 80px 10px 10px 10px;
	}
</style>
<body>

	<!-- 共通ユーザーヘッダー（ナビゲーション） -->
	<div th:replace="~{fragments/user-header :: userHeader}"></div>

	<div class="content-wrap"><!--content-wrap-->

		<div class="quiz-container">
			<!-- ヘッダー：タイトル＋ログイン中ユーザー＋HOMEリンク -->
			<div class="header">
				<div style="margin-bottom: 8px;">
					<h1><img th:src="@{/images/flashcard_icon.png}" alt="icon">暗記カード</h1>
					<!--        <p th:if="${loginUser != null}"-->
					<!--           style="font-size: 0.9rem; color: #666; margin-top: 4px;">-->
					<!--          ログイン中：-->
					<!--          <span th:text="${loginUser.name}">User Name</span>-->
					<!--        </p>-->
				</div>
				<!--      <p style="margin-top: 8px;">-->
				<!--        <a th:href="@{/user/home}"-->
				<!--           style="font-size: 0.9rem; color: #0288d1; text-decoration: none;">-->
				<!--          ユーザーHOMEへ戻る-->
				<!--        </a>-->
				<!--      </p>-->
			</div>

			<!-- 説明文 -->
<!--			<p style="margin-bottom: 20px; color: #444; font-size: 0.95rem; text-align: center;">-->
<!--				ランダムに表示される英単語を暗記するページです。<br />-->
<!--				「めくる」ボタンで日本語が表示され、「次へ」で別の単語に進みます。-->
<!--			</p>-->

			<!-- カード本体（Ocean の question-section を流用） -->
			<div class="question-section">
				<div>
					<!-- 英単語（常に表示） -->
<!--					<p style="color: #666; margin-bottom: 8px;">英単語</p>-->
					<p id="question-word" class="question-text" th:text="${cardWord.english}">example</p>
					
					<button type="button" onclick="speakElement('#question-word')"
						style="width: 7%;
					    		border: none;
					    		background-color: transparent;
								position: absolute;
								right: 18px;
								bottom: 11px;">
						<span><img class="onsei-img" th:src="@{/images/icon_onsei_1.png}" style="width: 100%;"></span>
					</button>

					<!-- 日本語（初期状態は非表示／めくるボタンで表示） -->
					<div id="answerArea" style="margin-top: 34px; display: none;">
<!--						<p style="color: #666; margin-bottom: 4px;">日本語</p>-->
						<p style="font-size: 22px; color: #01579b; margin: 0;" th:text="${cardWord.japanese}">
							例
						</p>
					</div>
				</div>
			</div>

			<!-- ボタンエリア（答え／次へ） -->
			<div class="quiz-next-wrapper" style="display: flex; gap: 12px; margin-top: 0;">
				<!-- 答え -->
				<button id="revealButton" type="button" class="quiz-next-button" style="width: 50%;">
					答え
				</button>

				<!-- 次へ：常に表示（新しい単語へ） -->
				<a th:href="@{/user/cards}" class="quiz-next-button"
					style="width: 50%; text-align: center; display: inline-block;">
					次へ
				</a>
			</div>
		</div>
	</div><!--content-wrap-->

	<!-- めくるボタン用のシンプルなJavaScript -->
	<script>
		document.addEventListener("DOMContentLoaded", function () {
			const revealButton = document.getElementById("revealButton");
			const answerArea = document.getElementById("answerArea");

			if (revealButton && answerArea) {
				revealButton.addEventListener("click", function () {
					// 日本語の答えを表示
					answerArea.style.display = "block";
					
					playMekuruSound();   // めくる音
					
					// ボタンは一度押したら無効化（連打防止）
					revealButton.disabled = true;
				});
			}
		});
		
		
		{
			// tts.js
			// 指定したセレクタの要素内テキストを読み上げる関数

			function speakElement(selector) {
			  // ブラウザが TTS に対応しているかチェック
			  if (!('speechSynthesis' in window)) {
			    alert('このブラウザは読み上げに対応していません');
			    return;
			  }

			  const el = document.querySelector(selector);
			  if (!el) {
			    console.warn('要素が見つかりません: ' + selector);
			    return;
			  }

			  // タグの中の文字だけを取得（HTMLタグは除外）
			  const text = el.textContent.trim();
			  if (!text) {
			    console.warn('読み上げるテキストがありません');
			    return;
			  }

			  // 前の読み上げが残っていたら止める
			  speechSynthesis.cancel();

			  const utterance = new SpeechSynthesisUtterance(text);
			  utterance.lang = 'en-US'; // 英語
			  utterance.rate = 0.9;     // 速度（お好みで調整可）

			  speechSynthesis.speak(utterance);
			}
		}
		
	</script>
	
	<!-- めくる音 -->
	<audio id="mekuruSound" th:src="@{/sounds/mekuru.mp3}"></audio>
	<script th:src="@{/js/quiz-sound.js}"></script>
	<script th:src="@{/js/hamburger.js}"></script>
</body>

</html>