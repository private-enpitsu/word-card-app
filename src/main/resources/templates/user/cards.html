<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>æš—è¨˜ã‚«ãƒ¼ãƒ‰</title>

	<!-- Ocean å…±é€šãƒ†ãƒ¼ãƒCSS -->
	<link rel="stylesheet" th:href="@{/css/ocean-theme.css}" />
	<link rel="icon" type="image/x-icon" th:href="@{/favicon.ico}">
</head>

<body>

	<!-- å…±é€šãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ -->
	<div th:replace="~{fragments/user-header :: userHeader}"></div>

	<div class="content-wrap"><!--content-wrap-->

		<div class="quiz-container">
			<!-- ãƒ˜ãƒƒãƒ€ãƒ¼ï¼šã‚¿ã‚¤ãƒˆãƒ«ï¼‹ãƒ­ã‚°ã‚¤ãƒ³ä¸­ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‹HOMEãƒªãƒ³ã‚¯ -->
			<div class="header">
				<div style="margin-bottom: 8px;">
					<h1>ğŸŒŠ æš—è¨˜ã‚«ãƒ¼ãƒ‰</h1>
					<!--        <p th:if="${loginUser != null}"-->
					<!--           style="font-size: 0.9rem; color: #666; margin-top: 4px;">-->
					<!--          ãƒ­ã‚°ã‚¤ãƒ³ä¸­ï¼š-->
					<!--          <span th:text="${loginUser.name}">User Name</span>-->
					<!--        </p>-->
				</div>
				<!--      <p style="margin-top: 8px;">-->
				<!--        <a th:href="@{/user/home}"-->
				<!--           style="font-size: 0.9rem; color: #0288d1; text-decoration: none;">-->
				<!--          ãƒ¦ãƒ¼ã‚¶ãƒ¼HOMEã¸æˆ»ã‚‹-->
				<!--        </a>-->
				<!--      </p>-->
			</div>

			<!-- èª¬æ˜æ–‡ -->
			<p style="margin-bottom: 20px; color: #444; font-size: 0.95rem; text-align: center;">
				ãƒ©ãƒ³ãƒ€ãƒ ã«è¡¨ç¤ºã•ã‚Œã‚‹è‹±å˜èªã‚’æš—è¨˜ã™ã‚‹ãƒšãƒ¼ã‚¸ã§ã™ã€‚<br />
				ã€Œã‚ãã‚‹ã€ãƒœã‚¿ãƒ³ã§æ—¥æœ¬èªãŒè¡¨ç¤ºã•ã‚Œã€ã€Œæ¬¡ã¸ã€ã§åˆ¥ã®å˜èªã«é€²ã¿ã¾ã™ã€‚
			</p>

			<!-- ã‚«ãƒ¼ãƒ‰æœ¬ä½“ï¼ˆOcean ã® question-section ã‚’æµç”¨ï¼‰ -->
			<div class="question-section">
				<div>
					<!-- è‹±å˜èªï¼ˆå¸¸ã«è¡¨ç¤ºï¼‰ -->
					<p style="color: #666; margin-bottom: 8px;">è‹±å˜èª</p>
					<p id="question-word" class="question-text" th:text="${cardWord.english}">example</p>
					
					<button type="button" onclick="speakElement('#question-word')"
						style="width: 7%;
					    		border: none;
					    		background-color: transparent;
								position: absolute;
								right: 18px;
								bottom: 11px;">
						<span><img class="onsei-img" th:src="@{/images/icon_onsei_1.png}" style="width: 100%;"></span>
					</button>

					<!-- æ—¥æœ¬èªï¼ˆåˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤ºï¼ã‚ãã‚‹ãƒœã‚¿ãƒ³ã§è¡¨ç¤ºï¼‰ -->
					<div id="answerArea" style="margin-top: 34px; display: none;">
						<p style="color: #666; margin-bottom: 4px;">æ—¥æœ¬èª</p>
						<p style="font-size: 22px; color: #01579b; margin: 0;" th:text="${cardWord.japanese}">
							ä¾‹
						</p>
					</div>
				</div>
			</div>

			<!-- ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ï¼ˆã‚ãã‚‹ï¼æ¬¡ã¸ï¼‰ -->
			<div class="quiz-next-wrapper" style="display: flex; gap: 12px; margin-top: 0;">
				<!-- ã‚ãã‚‹ï¼ˆç­”ãˆã‚’è¡¨ç¤ºï¼‰ -->
				<button id="revealButton" type="button" class="quiz-next-button" style="width: 50%;">
					ã‚ãã‚‹
				</button>

				<!-- æ¬¡ã¸ï¼šå¸¸ã«è¡¨ç¤ºï¼ˆæ–°ã—ã„å˜èªã¸ï¼‰ -->
				<a th:href="@{/user/cards}" class="quiz-next-button"
					style="width: 50%; text-align: center; display: inline-block;">
					æ¬¡ã¸
				</a>
			</div>
		</div>
	</div><!--content-wrap-->

	<!-- ã‚ãã‚‹ãƒœã‚¿ãƒ³ç”¨ã®ã‚·ãƒ³ãƒ—ãƒ«ãªJavaScript -->
	<script>
		document.addEventListener("DOMContentLoaded", function () {
			const revealButton = document.getElementById("revealButton");
			const answerArea = document.getElementById("answerArea");

			if (revealButton && answerArea) {
				revealButton.addEventListener("click", function () {
					// æ—¥æœ¬èªã®ç­”ãˆã‚’è¡¨ç¤º
					answerArea.style.display = "block";
					
					playMekuruSound();   // ã‚ãã‚‹éŸ³
					
					// ãƒœã‚¿ãƒ³ã¯ä¸€åº¦æŠ¼ã—ãŸã‚‰ç„¡åŠ¹åŒ–ï¼ˆé€£æ‰“é˜²æ­¢ï¼‰
					revealButton.disabled = true;
				});
			}
		});
		
		
		{
			// tts.js
			// æŒ‡å®šã—ãŸã‚»ãƒ¬ã‚¯ã‚¿ã®è¦ç´ å†…ãƒ†ã‚­ã‚¹ãƒˆã‚’èª­ã¿ä¸Šã’ã‚‹é–¢æ•°

			function speakElement(selector) {
			  // ãƒ–ãƒ©ã‚¦ã‚¶ãŒ TTS ã«å¯¾å¿œã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
			  if (!('speechSynthesis' in window)) {
			    alert('ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯èª­ã¿ä¸Šã’ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“');
			    return;
			  }

			  const el = document.querySelector(selector);
			  if (!el) {
			    console.warn('è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ' + selector);
			    return;
			  }

			  // ã‚¿ã‚°ã®ä¸­ã®æ–‡å­—ã ã‘ã‚’å–å¾—ï¼ˆHTMLã‚¿ã‚°ã¯é™¤å¤–ï¼‰
			  const text = el.textContent.trim();
			  if (!text) {
			    console.warn('èª­ã¿ä¸Šã’ã‚‹ãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚Šã¾ã›ã‚“');
			    return;
			  }

			  // å‰ã®èª­ã¿ä¸Šã’ãŒæ®‹ã£ã¦ã„ãŸã‚‰æ­¢ã‚ã‚‹
			  speechSynthesis.cancel();

			  const utterance = new SpeechSynthesisUtterance(text);
			  utterance.lang = 'en-US'; // è‹±èª
			  utterance.rate = 0.9;     // é€Ÿåº¦ï¼ˆãŠå¥½ã¿ã§èª¿æ•´å¯ï¼‰

			  speechSynthesis.speak(utterance);
			}
		}
		
	</script>
	
	<!-- ã‚ãã‚‹éŸ³ -->
	<audio id="mekuruSound" th:src="@{/sounds/mekuru.mp3}"></audio>
	<script th:src="@{/js/quiz-sound.js}"></script>
</body>

</html>