<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>英単語4択クイズ（ログイン後）</title>

  <!-- Bootstrap と共通CSSを読み込み -->
  <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}" />
  <link rel="stylesheet" th:href="@{/css/style.css}" />

  <!-- このページ用の簡易スタイル（ボタンカラーなど） -->
  <style>
    .quiz-question {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 16px;
    }

    .quiz-choice-btn {
      display: block;
      width: 100%;
      padding: 10px 14px;
      margin-bottom: 8px;
      border: 1px solid #ccc;
      border-radius: 3px;
      background-color: #fff;
      cursor: pointer;
      text-align: left;
      box-sizing: border-box;
    }

    .quiz-choice-btn.disabled {
      cursor: default;
      pointer-events: none;
    }

    .quiz-choice-correct-clicked {
      background-color: #5bbefa;
      font-weight: 700;
      color: #fff;
      text-shadow: 1px 1px 5px #808080;
    }

    .quiz-choice-wrong-clicked {
      background-color: #fba24e;
    }

    .quiz-choice-correct-answer {
      background-color: #5bbefa;
      font-weight: 700;
      color: #fff;
      text-shadow: 1px 1px 5px #808080;
    }
  </style>
</head>
<body class="bg-light">

  <div class="container my-4">

    <!-- タイトル行＋HOMEへ戻る -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h1 class="mb-0">英単語4択クイズ（ログイン後）</h1>
        <!-- ログイン中ユーザー名（必要なければこの行は削除してOK） -->
        <p class="text-muted mb-0" th:if="${loginUser != null}">
          ログイン中：<span th:text="${loginUser.name}">User Name</span>
        </p>
      </div>
      <a class="btn btn-outline-secondary" th:href="@{/user/home}">
        ユーザーHOMEへ戻る
      </a>
    </div>

    <!-- 説明文 -->
    <p>次の英単語の意味として正しいものを1つ選んでください。</p>

    <!-- 問題文 -->
    <h2 class="quiz-question" th:text="${questionWord.english}">today</h2>

    <!-- 正解の日本語（JavaScriptで参照するため hidden で保持） -->
    <input type="hidden" id="correctJapanese" th:value="${correctJapanese}" />

    <!-- 選択肢 -->
    <div id="choices-container" class="mb-3">
      <button
        type="button"
        class="quiz-choice-btn"
        th:each="choice : ${choices}"
        th:text="${choice}"
        th:attr="data-choice=${choice}">
        サンプル選択肢
      </button>
    </div>

    <!-- 不正解時のみ表示する「次へ」ボタン -->
    <div class="text-center">
      <button
        id="nextButton"
        class="btn btn-primary"
        type="button"
        style="display: none;">
        次へ
      </button>
    </div>

  </div>

  <!-- Bootstrap の JavaScript（必要に応じて） -->
  <script th:src="@{/js/bootstrap.bundle.min.js}"></script>

  <!-- クイズ用 JavaScript -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const correctJapaneseInput = document.getElementById("correctJapanese");
      const correctJapanese = correctJapaneseInput ? correctJapaneseInput.value : "";

      const choiceButtons = document.querySelectorAll(".quiz-choice-btn");
      const nextButton = document.getElementById("nextButton");

      let answered = false;

      choiceButtons.forEach(function (btn) {
        btn.addEventListener("click", function () {
          if (answered) {
            return;
          }
          answered = true;

          const selected = btn.getAttribute("data-choice");

          // 多重クリック防止
          choiceButtons.forEach(function (b) {
            b.classList.add("disabled");
          });

          if (selected === correctJapanese) {
            // 正解
            btn.classList.add("quiz-choice-correct-clicked");

            setTimeout(function () {
              // ★ ログイン後版なので /user/quiz を再読込
              window.location.href = "/user/quiz";
            }, 1500);
          } else {
            // 不正解
            btn.classList.add("quiz-choice-wrong-clicked");

            // 正解の選択肢にだけ「正解」スタイルを付ける
            choiceButtons.forEach(function (b) {
              const value = b.getAttribute("data-choice");
              if (value === correctJapanese) {
                b.classList.add("quiz-choice-correct-answer");
              }
            });

            // 「次へ」ボタンを表示し、ユーザー操作で次の問題へ
            if (nextButton) {
              nextButton.style.display = "inline-block";
              nextButton.addEventListener("click", function () {
                window.location.href = "/user/quiz";
              });
            }
          }
        });
      });
    });
  </script>
</body>
</html>
