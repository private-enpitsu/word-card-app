<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ—¥æœ¬èª â†’ è‹±èªå…¥åŠ›ã‚¯ã‚¤ã‚º</title>

  <!-- Ocean å…±é€šãƒ†ãƒ¼ãƒCSS -->
  <link rel="stylesheet" th:href="@{/css/ocean-theme.css}" />
  <link rel="icon" type="image/x-icon" th:href="@{/favicon.ico}">

  <style>
    /* å…¥åŠ›ã‚¯ã‚¤ã‚ºç”»é¢å°‚ç”¨ã®è»½ã„èª¿æ•´ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */

    .input-quiz-header-title {
      font-size: 1.4rem;
      margin-bottom: 8px;
    }

    .input-quiz-sub-text {
      font-size: 0.95rem;
      color: #555;
      margin-bottom: 20px;
      text-align: center;
    }

    /* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚¨ãƒªã‚¢ */
    .input-quiz-form {
      margin-top: 20px;
    }

    .input-quiz-label {
      font-size: 0.95rem;
      color: #555;
      margin-bottom: 10px;
      display: block;
    }

    .input-quiz-textbox {
      width: 100%;
      padding: 13px 15px;
      border-radius: 10px;
      border: 1px solid #bde6ff;
      font-size: 1.3rem;
      box-sizing: border-box;
    }

    .input-quiz-textbox:focus {
      outline: none;
      box-shadow: 0 0 0 2px rgba(33, 147, 176, 0.3);
      border-color: #4fc3f7;
    }

    .input-quiz-submit-wrap {
      margin-top: 32px;
      text-align: right;
    }

    .input-quiz-submit-button {
      min-width: 140px;
    }

    /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºç”¨ãƒœãƒƒã‚¯ã‚¹ */
    .input-quiz-message {
      margin-top: 20px;
      padding: 12px 14px;
      border-radius: 10px;
      font-size: 0.95rem;
    }

    .input-quiz-message.error {
      background: #ffebee;
      border: 1px solid #ffcdd2;
      color: #c62828;
    }

    .input-quiz-message.correct {
      background: #e0f2f1;
      border: 1px solid #80cbc4;
      color: #00695c;
      font-weight: 600;
    }

    .input-quiz-message.wrong {
      background: #fff3e0;
      border: 1px solid #ffcc80;
      color: #e65100;
    }

    .input-quiz-next-wrap {
      margin-top: 46px;
      text-align: center;
    }

    .input-quiz-next-button {
      min-width: 180px;
    }

    /* ã‚¹ãƒãƒ›èª¿æ•´ */
    @media (max-width: 600px) {
      .quiz-container {
        padding: 24px;
        margin: 0 10px;
      }

      .input-quiz-header-title {
        font-size: 1.2rem;
      }
    }
  </style>
</head>

<body>

  <!-- å…±é€šãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ -->
  <div th:replace="~{fragments/user-header :: userHeader}"></div>

  <div class="content-wrap"><!-- content-wrap -->

    <div class="quiz-container">

      <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
      <div class="header">
        <h1 class="input-quiz-header-title">ğŸŒŠ è‹±èªå…¥åŠ›ã‚¯ã‚¤ã‚º</h1>
        <p class="input-quiz-sub-text">
          è¡¨ç¤ºã•ã‚ŒãŸæ—¥æœ¬èªã®æ„å‘³ã«å¯¾å¿œã™ã‚‹è‹±å˜èªã‚’ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‹ã‚‰å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<br />
          å¤§æ–‡å­—ãƒ»å°æ–‡å­—ã¯åŒºåˆ¥ã—ã¾ã›ã‚“ã€‚
        </p>
      </div>

      <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ï¼ˆè¦‹ãŸç›®ã®çµ±ä¸€ç”¨ãƒ»ä¸­èº«ã¯ãƒ€ãƒŸãƒ¼ã§OKï¼‰ -->
      <div class="progress-bar">
        <div class="progress-fill"></div>
      </div>

      <!-- å•é¡Œæ–‡ã‚¨ãƒªã‚¢ -->
      <div class="question-section">
        <!-- æ—¥æœ¬èªã®å‡ºé¡Œæ–‡ -->
<!--        <p style="color: #666; margin-bottom: 6px;">æ—¥æœ¬èªã®æ„å‘³</p>-->
        <p class="question-text"
           th:text="${questionWord != null} ? ${questionWord.japanese} : 'æ—¥æœ¬èªã®æ„å‘³ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™'">
          ã‚µãƒ³ãƒ—ãƒ«ã®æ—¥æœ¬èª
        </p>
      </div>

      <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆç©ºå…¥åŠ›ãªã©ï¼‰ -->
      <div th:if="${errorMessage != null}"
           class="input-quiz-message error"
           th:text="${errorMessage}">
        è‹±å˜èªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
      </div>

      <!-- æ­£è§£ãƒ»ä¸æ­£è§£ã®åˆ¤å®šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
      <div th:if="${resultMessage != null}">
        <!-- æ­£è§£æ™‚ -->
        <div th:if="${isCorrect}"
             class="input-quiz-message correct"
             th:text="${resultMessage}">
          æ­£è§£ã§ã™ï¼
        </div>

        <!-- ä¸æ­£è§£æ™‚ï¼ˆisCorrect ãŒ false ã®å ´åˆï¼‰ -->
        <div th:if="${isCorrect == false}"
             class="input-quiz-message wrong"
             th:text="${resultMessage}">
          ä¸æ­£è§£ã§ã™ã€‚æ­£è§£ï¼šexample
        </div>
      </div>

      <!-- å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
      <form th:action="@{/user/input-quiz}" method="post" class="input-quiz-form">
        <!-- å‡ºé¡Œã«ä½¿ç”¨ã—ãŸå˜èªã®IDï¼ˆåˆ¤å®šç”¨ï¼‰ -->
        <input type="hidden" name="wordId"
               th:value="${wordId}" />

        <!-- è‹±å˜èªã®å…¥åŠ›æ¬„ -->
        <label for="answer" class="input-quiz-label">è‹±å˜èªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</label>
        <input id="answer"
               name="answer"
               type="text"
               class="input-quiz-textbox"
               autocomplete="off"
               placeholder="ä¾‹ï¼‰example"
               th:value="${userAnswer}" />

	   <!-- æ­£è§£ã®è‹±å˜èªï¼ˆéŸ³ã®åˆ¤å®šç”¨ã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã‚‚å‚ç…§ã™ã‚‹ï¼‰ -->
	   <input type="hidden" id="correctEnglish" th:value="${questionWord.english}" />
			   
        <!-- é€ä¿¡ãƒœã‚¿ãƒ³ -->
        <div class="input-quiz-submit-wrap">
          <button type="submit"
                  class="quiz-next-button input-quiz-submit-button">
            ç­”ãˆåˆã‚ã›
          </button>
        </div>
		

		<!-- åˆ¤å®šçµæœã‚’ JS ã‹ã‚‰å‚ç…§ã™ã‚‹ãŸã‚ã® hidden -->
		<input type="hidden" id="quizResult"    th:value="${resultMessage}" />
		<input type="hidden" id="quizIsCorrect" th:value="${isCorrect}" />
      </form>

      <!-- æ¬¡ã®å•é¡Œã¸ï¼ˆGET /user/input-quiz ã«æˆ»ã‚‹ï¼‰ -->
      <div class="input-quiz-next-wrap">
        <a th:href="@{/user/input-quiz}"
           class="quiz-next-button input-quiz-next-button">
          æ¬¡ã®å•é¡Œã¸
        </a>
      </div>

    </div><!-- /.quiz-container -->

  </div><!-- /.content-wrap -->

  <script>
    // å…¥åŠ›ã‚¯ã‚¤ã‚ºç”¨ï¼šç­”ãˆåˆã‚ã›ãƒœã‚¿ãƒ³ï¼ˆãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ï¼‰æ™‚ã«éŸ³ã‚’é³´ã‚‰ã™å‡¦ç†
    document.addEventListener("DOMContentLoaded", function () {
      // â˜… ãƒ•ã‚©ãƒ¼ãƒ ã¯ class ã§å–å¾—ã™ã‚‹ï¼ˆth:action ã®å®ŸURLã«ä¾å­˜ã—ãªã„ï¼‰
      const form = document.querySelector(".input-quiz-form");
      const answerInput = document.getElementById("answer");
      const correctInput = document.getElementById("correctEnglish");

      if (!form || !answerInput || !correctInput) {
        return; // è¦ç´ ãŒãªã‘ã‚Œã°ä½•ã‚‚ã—ãªã„
      }

      form.addEventListener("submit", function (event) {
        // â˜… ã¾ãšã¯é€ä¿¡ã‚’ä¸€åº¦æ­¢ã‚ã‚‹ï¼ˆã“ã®ã¾ã¾ã ã¨å³ãƒªãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦éŸ³ãŒåˆ‡ã‚‰ã‚Œã‚‹ï¼‰
        event.preventDefault();

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã¨æ­£è§£ã‚’åŒã˜ãƒ«ãƒ¼ãƒ«ã§æ­£è¦åŒ–ã—ã¦æ¯”è¼ƒã™ã‚‹
        const normalize = (src) => {
          if (!src) return "";
          // å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ â†’ åŠè§’ã‚¹ãƒšãƒ¼ã‚¹
          let replaced = src.replace(/\u3000/g, " ");
          // å‰å¾Œã®ç©ºç™½ã‚’å‰Šé™¤
          replaced = replaced.trim();
          // å¤§æ–‡å­—ãƒ»å°æ–‡å­—ã‚’åŒºåˆ¥ã—ãªã„ãŸã‚ã«å°æ–‡å­—åŒ–
          return replaced.toLowerCase();
        };

        const user = normalize(answerInput.value);
        const correct = normalize(correctInput.value);

        // ç©ºå…¥åŠ›ã®å ´åˆã¯éŸ³ã‚’é³´ã‚‰ã•ãšã€ãã®ã¾ã¾é€ä¿¡ï¼ˆã‚µãƒ¼ãƒå´ã§ã€Œå…¥åŠ›ã—ã¦ãã ã•ã„ã€è¡¨ç¤ºï¼‰
        if (!user) {
          form.submit();
          return;
        }

        // æ­£è§£ãƒ»ä¸æ­£è§£ã«å¿œã˜ã¦éŸ³ã‚’é³´ã‚‰ã™
        if (user === correct) {
          if (typeof playCorrectSound === "function") {
            playCorrectSound();
          }
        } else {
          if (typeof playWrongSound === "function") {
            playWrongSound();
          }
        }

        // â˜… å°‘ã—å¾…ã£ã¦ã‹ã‚‰ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ï¼ˆéŸ³ã‚’é³´ã‚‰ã™æ™‚é–“ã‚’ç¢ºä¿ï¼‰
        setTimeout(function () {
          form.submit();
        }, 800); // 0.6ç§’ãã‚‰ã„ï¼ˆå¥½ã¿ã§èª¿æ•´å¯ï¼‰
      });
    });
  </script>


  
  <audio id="correctSound" th:src="@{/sounds/correct.mp3}"></audio>
  <audio id="wrongSound"   th:src="@{/sounds/wrong.mp3}"></audio>
  <script th:src="@{/js/quiz-sound.js}"></script>
</body>

</html>
